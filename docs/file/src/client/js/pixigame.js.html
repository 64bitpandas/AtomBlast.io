<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/client/js/pixigame.js | atomblast.io</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="First attempt at multiplayer online io game"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="atomblast.io"><meta property="twitter:description" content="First attempt at multiplayer online io game"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/BananiumLabs/AtomBlast.io.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-js">client/js</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bindHandler">bindHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-displayWinner">displayWinner</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hideElement">hideElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-quitGame">quitGame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showElement">showElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateAtomList">updateAtomList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateCompoundButtons">updateCompoundButtons</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateLobby">updateLobby</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateScores">updateScores</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distanceBetween">distanceBetween</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCurrTile">getCurrTile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInBounds">isInBounds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createPlayer">createPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-destroyPIXI">destroyPIXI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getIngame">getIngame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isFocused">isFocused</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadTextures">loadTextures</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mouseDownHandler">mouseDownHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mouseUpHandler">mouseUpHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setIngame">setIngame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showGameUI">showGameUI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-startGame">startGame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-beginConnection">beginConnection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-disconnect">disconnect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-cookieInputs">cookieInputs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-selectedBlueprints">selectedBlueprints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-selectedCompound">selectedCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-GLOBAL">GLOBAL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-objects">objects</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-js-lib">client/js/lib</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/lib/chat-client.js~ChatClient.html">ChatClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-eraseCookie">eraseCookie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCookie">getCookie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setCookie">setCookie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-keyboard">keyboard</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-js-obj">client/js/obj</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/obj/gameobject.js~GameObject.html">GameObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/obj/maptile.js~MapTile.html">MapTile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/obj/player.js~Player.html">Player</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createPlayer">createPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createRenderAtom">createRenderAtom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createRenderCompound">createRenderCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-requestCreateCompound">requestCreateCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BLUEPRINTS">BLUEPRINTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MAP_LAYOUT">MAP_LAYOUT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TILES">TILES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TILE_NAMES">TILE_NAMES</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server">server</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deleteObject">deleteObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getField">getField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-incrementField">incrementField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setField">setField</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server-utils">server/utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-canCraft">canCraft</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-incrementAtom">incrementAtom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spawnAtom">spawnAtom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spawnAtomAtVent">spawnAtomAtVent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-collisionDetect">collisionDetect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createCompound">createCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-tickCompound">tickCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-frameSync">frameSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-roomMatchmaker">roomMatchmaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-damage">damage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-splash">splash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initGlobal">initGlobal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initPlayer">initPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateID">generateID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTeamNumber">getTeamNumber</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/client/js/pixigame.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import * as PIXI from &apos;pixi.js&apos;;
import { keyboard } from &apos;./lib/keyboard&apos;;
import { GLOBAL } from &apos;./global&apos;;
import { Player } from &apos;./obj/player&apos;;
import { hideElement, showElement, selectedBlueprints, updateAtomList, updateCompoundButtons, selectedCompound, cookieInputs, mouseX, mouseY } from &apos;./app&apos;;
import { socket, objects } from &apos;./socket&apos;;
import { BLUEPRINTS } from &apos;./obj/blueprints&apos;;
import { TILES, MAP_LAYOUT, TILE_NAMES } from &apos;./obj/tiles&apos;;
import { requestCreateCompound } from &apos;./obj/create&apos;;
import { MapTile } from &apos;./obj/maptile&apos;;

export var isSetup; // True after the stage is fully set up
export var player; // The player being controlled by this client
export var screenCenterX; // X-coordinate of the center of the screen
export var screenCenterY; // Y-coordinate of the center of the screen
export var app; // Pixi app


let inGame = false; // True after game has begun
let mouseDown = false; // True if mouse is pressed down

// let sprites = []; // Sprites on the stage

let esc, space, blueprintKeys, moveKeys; // Key handlers
let vertLines = [];
let horizLines = [];
let streamID = 0; // Current stream compound number. Resets when mouse/space is released; otherwise increments by one every time a compound is created.

export function loadTextures() {
	if (!isSetup) {
		//Initialization
		let type = (PIXI.utils.isWebGLSupported()) ? &apos;WebGL&apos; : &apos;canvas&apos;;
		PIXI.utils.sayHello(type);

		//Create a Pixi Application
		app = new PIXI.Application(0, 0, {
			view: document.getElementById(&apos;gameView&apos;)
		});
		//Add the canvas that Pixi automatically created for you to the HTML document
		// document.body.appendChild(app.view);

		// Renderer settings
		app.renderer.autoResize = true;
		app.renderer.resize(window.innerWidth, window.innerHeight);
		screenCenterX = window.innerWidth / 2 - GLOBAL.PLAYER_RADIUS;
		screenCenterY = window.innerHeight / 2 - GLOBAL.PLAYER_RADIUS;

		// Load resources if not already loaded
		let TEXTURES = [];
		TEXTURES.push(GLOBAL.IGNITE_SPRITE);
		for (let bp in BLUEPRINTS) {
			// Prevent duplicate textures from being loaded
			if (TEXTURES.indexOf(BLUEPRINTS[bp].texture) &lt; 0)
				TEXTURES.push(BLUEPRINTS[bp].texture);
			if (BLUEPRINTS[bp].params.splashImage !== undefined &amp;&amp; TEXTURES.indexOf(BLUEPRINTS[bp].params.splashImage) &lt; 0)
				TEXTURES.push(BLUEPRINTS[bp].params.splashImage);
		}
		for (let atom of GLOBAL.ATOM_SPRITES)
			if (TEXTURES.indexOf(atom) &lt; 0)
				TEXTURES.push(atom);
		for(let tile in TILES)
			if (TEXTURES.indexOf(GLOBAL.TILE_TEXTURE_DIR + TILES[tile].texture) &lt; 0)
				TEXTURES.push(GLOBAL.TILE_TEXTURE_DIR + TILES[tile].texture);
		console.log(TEXTURES);


		if (Object.keys(PIXI.loader.resources).length &lt; 1) {
			PIXI.loader
				.add(GLOBAL.PLAYER_SPRITES)
				.add(TEXTURES)
				.load(registerCallbacks);
		}
	}

	// If already initialized, use existing app variable
	if (isSetup) {
		console.info(&apos;Stage already initialized!&apos;);
		clearStage();
		registerCallbacks();
	}
}

/**
 * Sets up the stage. Call after init(), and begins the draw() loop once complete.
 */
function registerCallbacks() {
	if (!isSetup) {
		// Set up key listeners
		esc = keyboard(GLOBAL.KEY_ESC);
		space = keyboard(GLOBAL.KEY_SPACE);

		//All the movement keys for easy access
		moveKeys = [
			keyboard(GLOBAL.KEY_A), // Left           
			keyboard(GLOBAL.KEY_D), // Right                 
			keyboard(GLOBAL.KEY_W), // Up               
			keyboard(GLOBAL.KEY_S), // Down              
		];
		//Set up the blueprint key listeners
		blueprintKeys = [
			keyboard(GLOBAL.KEY_1),
			keyboard(GLOBAL.KEY_2),
			keyboard(GLOBAL.KEY_3),
			keyboard(GLOBAL.KEY_4)
		];

		esc.press = () =&gt; {
			if (isFocused()) {
				if (document.activeElement !== document.getElementById(&apos;chatInput&apos;))
					toggleMenu();
				else
					document.getElementById(&apos;chatInput&apos;).blur();
			}
		};

		// Chat box styling on select
		document.getElementById(&apos;chatInput&apos;).onfocus = () =&gt; {
			document.getElementById(&apos;chatbox&apos;).style.boxShadow = &apos;0px 0px 1rem 0px #311B92&apos;;
		};

		document.getElementById(&apos;chatInput&apos;).onblur = () =&gt; {
			document.getElementById(&apos;chatbox&apos;).style.boxShadow = &apos;0px 0px 1rem 0px rgba(180,180,180)&apos;;
		};

		//Bind each blueprint key
		for (let key in blueprintKeys) {
			blueprintKeys[key].press = () =&gt; {
				if (isFocused() &amp;&amp; inGame) {
					updateCompoundButtons(key);
				}
			};
		}

		// Background
		app.renderer.backgroundColor = 0xFFFFFF;

		// Resize
		document.getElementsByTagName(&apos;body&apos;)[0].onresize = () =&gt; {
			app.renderer.resize(window.innerWidth, window.innerHeight);
			screenCenterX = window.innerWidth / 2 - GLOBAL.PLAYER_RADIUS;
			screenCenterY = window.innerHeight / 2 - GLOBAL.PLAYER_RADIUS;
			player.x = screenCenterX;
			player.y = screenCenterY;
		};

		// Begin game loop
		app.ticker.add(delta =&gt; draw(delta));
	}

	isSetup = true;

	// Draw map
	for (let row = 0; row &lt; MAP_LAYOUT.length; row++) {
		for (let col = 0; col &lt; MAP_LAYOUT[0].length; col++) {
			let tileName = &apos;tile_&apos; + col + &apos;_&apos; + row;
			if (objects.tiles[tileName] === undefined || objects.tiles[tileName] === null) {
				if (TILE_NAMES[MAP_LAYOUT[row][col]] !== undefined)
					objects.tiles[tileName] = new MapTile(TILE_NAMES[MAP_LAYOUT[row][col]], col, MAP_LAYOUT.length - row - 1);
				else
					throw new Error(&apos;Tile &apos; + MAP_LAYOUT[row][col] + &apos; could not be resolved to a name.&apos;);
			}
		}
	}

	// Draw grid
	// Grid
	let line;
	for (let x = 0; x &lt; window.innerWidth / GLOBAL.GRID_SPACING; x++) {
		line = new PIXI.Graphics();
		line.lineStyle(GLOBAL.GRID_LINE_STROKE, GLOBAL.GRID_LINE_COLOUR, 1);
		line.oX = x * GLOBAL.GRID_SPACING;
		line.moveTo(line.oX, 0);
		line.lineTo(line.oX, window.innerHeight);
		vertLines.push(line);
		app.stage.addChild(line);
	}
	for (let y = 0; y &lt; window.innerHeight / GLOBAL.GRID_SPACING; y++) {
		line = new PIXI.Graphics();
		line.lineStyle(GLOBAL.GRID_LINE_STROKE, GLOBAL.GRID_LINE_COLOUR, 1);
		line.oY = y * GLOBAL.GRID_SPACING;
		line.moveTo(0, line.oY);
		line.lineTo(window.innerWidth, line.oY);
		horizLines.push(line);
		app.stage.addChild(line);
	}


	showGameUI();
}

/**
 * Called once per frame. Updates all moving sprites on the stage.
 * Also checks key inputs.
 * @param {number} delta Time value from Pixi
 */
function draw(delta) {
	// Handle this player and movement
	if (player !== undefined) {

		// Make sure player is not in chat before checking move
		if (isFocused() &amp;&amp; inGame) {
			if (moveKeys[0].isDown &amp;&amp; player.vx &gt; -GLOBAL.MAX_SPEED * player.speedMult) // Left
				player.vx += -GLOBAL.VELOCITY_STEP * player.speedMult;
			if (moveKeys[1].isDown &amp;&amp; player.vx &lt; GLOBAL.MAX_SPEED * player.speedMult) // Right
				player.vx += GLOBAL.VELOCITY_STEP * player.speedMult;
			if (moveKeys[2].isDown &amp;&amp; player.vy &lt; GLOBAL.MAX_SPEED * player.speedMult) // Up
				player.vy += GLOBAL.VELOCITY_STEP * player.speedMult;
			if (moveKeys[3].isDown &amp;&amp; player.vy &gt; -GLOBAL.MAX_SPEED * player.speedMult) // Down
				player.vy += -GLOBAL.VELOCITY_STEP * player.speedMult;

			player.isMoving = false;
			for(let key of moveKeys)
				if(key.isDown)
					player.isMoving = true;
		} else {
			player.isMoving = false;

			//Because the document is not focused disable all keys(Stops moving!)
			for (let key in moveKeys) {
				moveKeys[key].isDown = false;
				moveKeys[key].isUp = true;
			}
		}

		// Slow down gradually - unaffected by chat input
		if (!moveKeys[2].isDown &amp;&amp; !moveKeys[3].isDown)
			player.vy *= GLOBAL.VELOCITY_STEP;
		if (!moveKeys[0].isDown &amp;&amp; !moveKeys[1].isDown)
			player.vx *= GLOBAL.VELOCITY_STEP;

		// Shooting
		space.press = () =&gt; {
			if(selectedBlueprints[selectedCompound].type !== &apos;stream&apos;) {
				shootHandler({clientX: mouseX, clientY: mouseY}, false);
			}
		};

		// Streams
		if ((space.isDown || mouseDown) &amp;&amp; selectedBlueprints[selectedCompound].type === &apos;stream&apos;) {
			shootHandler({ clientX: mouseX, clientY: mouseY }, true);
		}

		// Reset stream count when space key is released
		space.release = () =&gt; {
			streamID = 0;
		};

		// Move player
		player.tick();

		// Send coordinates
		socket.emit(&apos;move&apos;, {
			type: &apos;players&apos;,
			id: player.id,
			posX: player.posX,
			posY: player.posY,
			vx: player.vx,
			vy: player.vy
		});

		// Move grid
		for (let line of vertLines)
			line.x = line.oX - player.posX % (GLOBAL.GRID_SPACING * 2);

		for (let line of horizLines)
			line.y = line.oY + player.posY % (GLOBAL.GRID_SPACING * 2);
	}

	// Handle objects except for this player
	for (let objType in objects) {
		for (let obj in objects[objType])
			if (objType !== &apos;players&apos; || player !== objects[objType][obj]) {
				objects[objType][obj].tick();
			}
	}

}

/**
 * Shows or hides the in-game menu box
 */
function toggleMenu() {
	if (document.getElementById(&apos;menubox&apos;).offsetParent === null)
		showElement(&apos;menubox&apos;);
	else
		hideElement(&apos;menubox&apos;);
}

/**
 * Remove all elements pre-rendered on stage.
 */
function clearStage() {
	for (var i = app.stage.children.length - 1; i &gt;= 0; i--) {
		app.stage.removeChild(app.stage.children[i]);
	}
}

/**
 * Destroy everything in PIXI. DANGEROUS avoid!
 */
export function destroyPIXI() {
	app.destroy(true, {
		children: true,
		texture: true,
		baseTexture: true
	});
	PIXI.loader.reset();
	isSetup = false;
	app = undefined;
}

/**
 * Call this function to hide loading div and show UI
 */
export function showGameUI() {
	// Hide loading screen
	hideElement(&apos;loading&apos;);
	if(!inGame)
		showElement(&apos;lobby&apos;);
}

/**
 * Creates a Player instance once the stage is fully set up and ready.
 * @param {*} data Starting values to assign to the player. Generated from server
 * @returns {Player} The Player object that was created
 */
export function createPlayer(data) {
	if (isSetup) {
		console.log(&apos;create player &apos; + data.id);
		console.log(data);
		let newPlayer = new Player(PIXI.loader.resources[GLOBAL.PLAYER_SPRITES[0]].texture, data.id, data.name, data.room, data.team, data.health, data.posX, data.posY, data.vx, data.vy);
		if (data.id === socket.id)
			player = newPlayer;

		return newPlayer;
	}
}

/**
 * If the document is Focused return true otherwise false
 **/
export function isFocused() {
	return document.hasFocus() &amp;&amp; document.activeElement !== document.getElementById(&apos;chatInput&apos;);
}

/**
 * Starts the game after lobby closes.
 * @param {boolean} emit True if this client should emit the event to the server.
 * @param {*} teams Array of teams on the scoreboard.
 */
export function startGame(emit, teams) {
	setIngame(true);
	hideElement(&apos;lobby&apos;);
	showElement(&apos;hud&apos;);
	if (emit)
		socket.emit(&apos;startGame&apos;, {
			start: true
		});
    
	// Init scoreboard
	if(teams !== undefined) {
		// Reset scoreboard from previous rounds
		document.getElementById(&apos;score&apos;).innerHTML = &apos;&apos;;
        
		for(let i = 0; i &lt; teams.length; i++) {
			document.getElementById(&apos;score&apos;).innerHTML += &apos;-&lt;span id=&quot;team-score-&apos; + i + &apos;&quot;&gt;0&lt;/span&gt;&apos;;
			document.getElementById(&apos;team-score-&apos; + i).style.color = ((cookieInputs[2].value === teams[i].name) ? GLOBAL.FRIENDLY_COLOUR_HEX : GLOBAL.ENEMY_COLOUR_HEX);
		}
		document.getElementById(&apos;score&apos;).style.fontSize = &apos;3vw&apos;;
		document.getElementById(&apos;score&apos;).innerHTML += &apos;-&apos;;
	}
}

/**
 * Sets the value of inGame
 * @param {boolean} newValue Value to set inGame to 
 */
export function setIngame(newValue) {
	inGame = newValue;
}

/**
 * @returns {boolean} Returns inGame variable
 */
export function getIngame() {
	return inGame;
}

/**
 * Called on mouse up from app.js
 * @param {*} e Click event
 */
export function mouseUpHandler(e) {
	mouseDown = true;
	if(selectedBlueprints[selectedCompound] &amp;&amp; selectedBlueprints[selectedCompound].type !== &apos;stream&apos;)
		shootHandler(e, false);
}
/**
 * Called on mouse down from app.js
 * @param {*} e Click event
 */
export function mouseDownHandler(e) {
	mouseDown = false;
	streamID = 0;
}

/**
 * Handles shooting mechanics on mouse/spacebar click/hold.
 * @param {*} e Click event
 * @param {boolean} stream True if sending a stream (such as water); false otherwise.
 */
function shootHandler(e, stream) {
	if (isFocused() &amp;&amp; inGame) {
		if (stream)
			streamID++;
		requestCreateCompound(selectedBlueprints[selectedCompound], e.clientX, e.clientY, streamID);
	}
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
