<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/client/js/socket.js | atomblast.io</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="First attempt at multiplayer online io game"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="atomblast.io"><meta property="twitter:description" content="First attempt at multiplayer online io game"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/BananiumLabs/AtomBlast.io.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-js">client/js</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bindHandler">bindHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-displayWinner">displayWinner</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hideElement">hideElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-quitGame">quitGame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showElement">showElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateAtomList">updateAtomList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateCompoundButtons">updateCompoundButtons</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateLobby">updateLobby</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateScores">updateScores</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distanceBetween">distanceBetween</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCurrTile">getCurrTile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isInBounds">isInBounds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createPlayer">createPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-destroyPIXI">destroyPIXI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getIngame">getIngame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isFocused">isFocused</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadTextures">loadTextures</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mouseDownHandler">mouseDownHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mouseUpHandler">mouseUpHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setIngame">setIngame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showGameUI">showGameUI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-startGame">startGame</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-beginConnection">beginConnection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-disconnect">disconnect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-cookieInputs">cookieInputs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-selectedBlueprints">selectedBlueprints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-selectedCompound">selectedCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-GLOBAL">GLOBAL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-objects">objects</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-js-lib">client/js/lib</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/lib/chat-client.js~ChatClient.html">ChatClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/lib/mobilejoystick.js~VirtualJoystick.html">VirtualJoystick</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-eraseCookie">eraseCookie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCookie">getCookie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setCookie">setCookie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-keyboard">keyboard</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-js-obj">client/js/obj</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/obj/gameobject.js~GameObject.html">GameObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/obj/maptile.js~MapTile.html">MapTile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/js/obj/player.js~Player.html">Player</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createPlayer">createPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createRenderAtom">createRenderAtom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createRenderCompound">createRenderCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-requestCreateCompound">requestCreateCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BLUEPRINTS">BLUEPRINTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MAP_LAYOUT">MAP_LAYOUT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TILES">TILES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TILE_NAMES">TILE_NAMES</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server">server</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deleteObject">deleteObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getField">getField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-incrementField">incrementField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setField">setField</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server-utils">server/utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-canCraft">canCraft</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-incrementAtom">incrementAtom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spawnAtom">spawnAtom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-spawnAtomAtVent">spawnAtomAtVent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-collisionDetect">collisionDetect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createCompound">createCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-tickCompound">tickCompound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addExperience">addExperience</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-frameSync">frameSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-roomMatchmaker">roomMatchmaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-damage">damage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-splash">splash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initGlobal">initGlobal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initPlayer">initPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateID">generateID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTeamNumber">getTeamNumber</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/client/js/socket.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { GLOBAL, distanceBetween } from &apos;./global&apos;
import { cookieInputs, quitGame, updateLobby, updateScores, showElement, hideElement, displayWinner, updateAtomList } from &apos;./app&apos;
import ChatClient from &apos;./lib/chat-client&apos;
import { loadTextures, app, createPlayer, isSetup, showGameUI, startGame, player, setIngame } from &apos;./pixigame&apos;
import { MapTile } from &apos;./obj/maptile&apos;
import { MAP_LAYOUT } from &apos;./obj/tiles&apos;
import { createRenderAtom, createRenderCompound } from &apos;./obj/create&apos;

/**
 * Socket.js contains all of the clientside networking interface.
 * It contains all variables which are synced between client and server.
 */

// Socket.io instance
export var socket

/* Object containing all synced objects. Contains nested objects, which correspond to different types
 * (for example, objects[atoms], objects[players], objects[compounds])
 */
export var objects = {
	players: {},
	atoms: {},
	compounds: {},
	tiles: {}
}

/**
 * Attempts to connect to the server. Run on &apos;start game&apos; press.
 *  - Manages connecting to main server vs. devserver
 *  - Sets up socket listeners
 *  - Loads textures
 *  - Loads pixi
 */
export function beginConnection () {
	// Joins debug server if conditions are met
	let room = (cookieInputs[7].value === &apos;private&apos; ? cookieInputs[1].value : GLOBAL.NO_ROOM_IDENTIFIER)
	if (cookieInputs[1].value === &apos;test&apos;) {
		console.info(&apos;Connecting to: &apos; + GLOBAL.TEST_IP)
		// DEVELOPMENT server - auto deploy from pixi branch
		socket = io.connect(GLOBAL.TEST_IP, {
			query: `room=${room}&amp;name=${cookieInputs[0].value}&amp;team=${cookieInputs[2].value}&amp;roomType=${cookieInputs[7].value}`,
			reconnectionAttempts: 3
		})
	}
	else if (cookieInputs[1].value === &apos;jurassicexp&apos;) {
		console.log(&apos;Dev Backdoor Initiated! Connecting to devserver&apos;)
		// Local server
		socket = io.connect(GLOBAL.LOCAL_HOST, {
			query: `room=${room}&amp;name=${cookieInputs[0].value}&amp;team=${cookieInputs[2].value}&amp;roomType=${cookieInputs[7].value}`,
			reconnectionAttempts: 3
		})
	}
	else {
		// Production server
		console.log(&apos;connecting to main server&apos;)
		socket = io.connect(GLOBAL.SERVER_IP, {
			query: `room=${room}&amp;name=${cookieInputs[0].value}&amp;team=${cookieInputs[2].value}&amp;roomType=${cookieInputs[7].value}`,
			reconnectionAttempts: 3
		})
	}

	socket.on(&apos;connect&apos;, () =&gt; {
		setupSocket()
		// Init pixi
		loadTextures()
		if (typeof app !== &apos;undefined&apos;) {
			app.start()
		}
	})
}

/**
 * Run on disconnect to reset all server-based variables and connections
 */
export function disconnect () {
	app.stop()
	socket.disconnect()

	// Wipe objects list
	for (let objType in objects) {
		objects[objType] = {}
	}
}

/**
 * First time setup when connection starts. Run on connect event to ensure that the socket is connected first.
 */
function setupSocket () {
	// Debug
	console.log(&apos;Socket:&apos;, socket)

	// Instantiate Chat System
	let chat = new ChatClient({ player: cookieInputs[0].value, room: cookieInputs[1].value, team: cookieInputs[2].value })
	chat.addLoginMessage(cookieInputs[0].value, true)
	chat.registerFunctions()

	// Setup listeners
	setupSocketConnection()
	setupSocketInfo(chat)
	setupSocketObjectRetrieval()

	// Emit join message,
	socket.emit(&apos;playerJoin&apos;, { sender: chat.player, team: chat.team })
}

/**
 * Sets up socket object syncing.
 * Run in setupSocket().
 */
function setupSocketObjectRetrieval () {
	// Syncs all objects from server once a frame
	socket.on(&apos;objectSync&apos;, (data) =&gt; {
		for (let objType in data) {
			if (objType !== &apos;tiles&apos;) {
				for (let obj in data[objType]) {
					if (data[objType][obj] !== null) {
						let objRef = data[objType][obj]
						let clientObj = objects[objType][obj]
						// Already exists in database
						if (clientObj !== undefined &amp;&amp; clientObj !== null) {
							if (objRef.id !== socket.id) {
								objects[objType][obj].setData(objRef.posX, objRef.posY, objRef.vx, objRef.vy)
							}
							if (objType === &apos;players&apos;) {
								objects[objType][obj].health = objRef.health
								objects[objType][obj].damagedBy = objRef.damagedBy
								objects[objType][obj].atomList = objRef.atomList
								objects[objType][obj].speedMult = objRef.speedMult
								objects[objType][obj].hasShield = objRef.hasShield
								for (let atom in objRef.atomList) {
									updateAtomList(atom)
								}
							}
							if (objType === &apos;compounds&apos; &amp;&amp; objRef.ignited) {
								objects[objType][obj].ignited = objRef.ignited
							}
						}
						// Does not exist - need to clone to clientside
						else if (isSetup) {
							switch (objType) {
								case &apos;players&apos;:
									objects[objType][obj] = createPlayer(objRef)
									break
								case &apos;atoms&apos;:
									objects[objType][obj] = createRenderAtom(objRef)
									break
								case &apos;compounds&apos;:
									objects[objType][obj] = createRenderCompound(objRef)
									break
							}
						}
					}
				}
			}
			// else { //Tile drawing
			//     for (let tile of data.tiles) {

			//         let tileName = &apos;tile_&apos; + tile.col + &apos;_&apos; + tile.row;
			//         if (objects.tiles[tileName] === undefined) {
			//             // console.log(tileName);
			//             objects.tiles[tileName] = new MapTile(MAP_LAYOUT[tile.row][tile.col], tile.col, tile.row);
			//         }

			//     }
			// }
		}
	})

	// Sync objects when they are deleted or move out of view. ONLY call after objectSync to avoid issue
	socket.on(&apos;serverSendObjectRemoval&apos;, (data) =&gt; {
		if (GLOBAL.VERBOSE_SOCKET) {
			console.info(&apos;serverSendObjectRemoval() called on: &apos;)
			console.info(data)
			console.info(objects[data.type][data.id])
			console.info(objects)
		}
		if (objects[data.type][data.id] === undefined || objects[data.type][data.id] === null) {
			console.warn(&apos;serverSendObjectRemoval() called on invalid object. Retry.&apos;)
			setTimeout(() =&gt; {
				try {
					if (removeObject(data)) {
						console.info(&apos;Retry successfully removed object. While this worked, it should not happen. Please fix root cause of issue. &apos;)
						return 0
					}
				}
				catch (err) {
					console.err(&apos;Retry failed. Object removal failed. Abandoning request. &apos;)
					return 1
				}
				// removeObject(data);
			}, 1000 / 60)
			// return 1
		}
		else {
			// console.log(objects[data.type][data.id].destroyed);
		// An object was removed
			if (!objects[data.type][data.id].destroyed) { // Only remove if not already
				removeObject(data)
			}
			else {
				console.warn(&apos;serverSendObjectRemoval() called despite object has already been destroyed.&apos;) // Sanity check
				return 1
			}
		}

		// Must keep checking if the object was not created at time of destruction.
		// One example of this needing to be run is when a player instantly collects an atom on spawn.
		// if (objects[data.type][data.id] === undefined) {
		// 	let thisInterval = setTimeout(() =&gt; {
		// 		if (objects[data.type][data.id].destroyed) {
		// 			clearInterval(thisInterval)
		// 		}
		// 		else {
		// 			removeObject(data)
		// 		}
		// 	}, 200)
		// }
	})
}

/**
 * Sets up socket connection listeners.
 * Run in setupSocket().
 */
function setupSocketConnection () {
	// On Connection Failure
	socket.on(&apos;reconnect_failed&apos;, () =&gt; {
		alert(&apos;You have lost connection to the server!&apos;)
	})

	socket.on(&apos;reconnecting&apos;, (attempt) =&gt; {
		console.log(&apos;Lost connection. Reconnecting on attempt: &apos; + attempt)
		quitGame(&apos;Lost connection to server&apos;)
	})

	socket.on(&apos;reconnect_error&apos;, (err) =&gt; {
		console.log(&apos;CRITICAL: Reconnect failed! &apos; + err)
	})

	socket.on(&apos;pong&apos;, (ping) =&gt; {
		console.log(&apos;Your Ping Is: &apos; + ping)
	})

	socket.on(&apos;disconnectedPlayer&apos;, (data) =&gt; {
		console.log(&apos;Player &apos; + data.id + &apos; has disconnected&apos;)
		chat.addSystemLine(&apos;Player &apos; + objects.players[data.id].name + &apos; has disconnected&apos;)
		if (objects.players[data.id] !== undefined) {
			objects.players[data.id].hide()
			delete objects.players[data.id]
		}
	})

	socket.on(&apos;serverSendDisconnect&apos;, () =&gt; {
		quitGame(&apos;The game has ended.&apos;, false)
		hideElement(&apos;winner-panel&apos;)
	})

	// Errors on join
	socket.on(&apos;connectionError&apos;, (data) =&gt; {
		socket.disconnect()
		quitGame(data.msg, true)
	})
}

/**
 * Sets up socket information transfer listeners.
 * Run in setupSocket().
 * @param {*} chat The chat client instance to be used for notifications
 */
function setupSocketInfo (chat) {
	// Chat system receiver
	socket.on(&apos;serverMSG&apos;, data =&gt; {
		chat.addSystemLine(data)
	})

	socket.on(&apos;serverSendPlayerChat&apos;, data =&gt; {
		chat.addChatLine(data.sender, data.message, false)
	})

	socket.on(&apos;serverSendLoginMessage&apos;, data =&gt; {
		chat.addLoginMessage(data.sender, false)
	})

	// Receive information about room players
	socket.on(&apos;roomInfo&apos;, (data) =&gt; {
		// Update lobby info. Pass to app.js
		updateLobby(data)

		// if(GLOBAL.DEBUG) {
		//     console.log(&quot;rcvd: &quot;,data);
		// }
	})

	socket.on(&apos;serverSendStartGame&apos;, (data) =&gt; {
		console.log(&apos;game has started&apos;)
		startGame(false, data.teams)
	})

	socket.on(&apos;levelUp&apos;, (data) =&gt; {
		console.log(&apos;You LEVELED UP! Level: &apos; + data.newLevel)
	})

	// Respawn
	socket.on(&apos;serverSendPlayerDeath&apos;, (data) =&gt; {
		console.log(&apos;You Died!&apos;)

		// TODO move trigger to server
		// Releases atoms and deletes the entire atoms array in player
		socket.emit(&apos;playerDeathAtoms&apos;, { atoms: player.atoms, x: player.posX, y: player.posY })
		for (let at in player.atoms) {
			player.atoms[at] = 0
			updateAtomList(at)
		}

		// Reset position to spawnpoint
		player.posX = GLOBAL.SPAWN_POINTS[data.teamNumber].x * GLOBAL.GRID_SPACING * 2
		player.posY = GLOBAL.SPAWN_POINTS[data.teamNumber].y * GLOBAL.GRID_SPACING * 2
		socket.emit(&apos;move&apos;, {
			id: socket.id,
			posX: player.posX,
			posY: player.posY,
			vx: 0,
			vy: 0,
			type: &apos;players&apos;
		})
	})

	// Another player died
	socket.on(&apos;serverSendNotifyPlayerDeath&apos;, (data) =&gt; {
		// Append to chat
	})

	// Update timer
	socket.on(&apos;time&apos;, (data) =&gt; {
		document.getElementById(&apos;timer&apos;).innerHTML = &apos;&lt;p&gt;&apos; + data.time + &apos;&lt;/p&gt;&apos;
	})

	// Update scores
	socket.on(&apos;serverSendScoreUpdate&apos;, (data) =&gt; {
		updateScores(data.teamSlot, data.increment)
	})

	// A player has won
	socket.on(&apos;serverSendWinner&apos;, (data) =&gt; {
		setIngame(false) // Disable keyboard controls and rendering
		displayWinner(data)
	})
}

/*
 ********************
 * Helper Functions *
 ********************
 */

// Linear Interpolation function. Adapted from p5.lerp
function lerp (v0, v1, t) {
	return v0 * (1 - t) + v1 * t
}

// Helper function for serverSendObjectRemoval
function removeObject (data) {
	if (objects[data.type][data.id] !== undefined &amp;&amp; objects[data.type][data.id] !== null) {
		objects[data.type][data.id].hide()
		objects[data.type][data.id].destroy()
		// delete objects[data.type][data.id];
		return true
	}
	else {
		return false
	}
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
